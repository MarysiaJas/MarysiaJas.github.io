<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Szczegóły dla Gości - Marysia i Jaś</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; margin: 0; background-color: #f9f9f9; color: #333; }
        header { background-color: #f0f0f0; padding: 20px 0; text-align: center; border-bottom: 1px solid #ddd; }
        nav a { margin: 0 15px; text-decoration: none; color: #333; font-weight: bold; }
        main { max-width: 800px; margin: 30px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1, h2, h3 { color: #444; text-align: center; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 40px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], textarea, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { display: block; width: 100%; padding: 12px; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background-color 0.2s; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #guest-form button { background-color: #28a745; }
        #guest-form button:hover { background-color: #218838; }
        #decline-form button { background-color: #dc3545; }
        #decline-form button:hover { background-color: #c82333; }
        .form-response { text-align: center; padding: 15px; margin-top: 20px; border-radius: 4px; display: none; }
        .form-response.success { background-color: #d4edda; color: #155724; }
        .form-response.error { background-color: #f8d7da; color: #721c24; }
        #plota-list { list-style-type: none; padding: 0; }
        #plota-list li { background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 8px; text-align: center; font-size: 1.1em; }
    </style>
</head>
<body>

    <header>
        <h1>Marysia i Jaś</h1>
        <nav>
            <a href="index.html">Strona Główna</a>
            <a href="szczegoly.html">Szczegóły dla gości weselnych</a>
        </nav>
    </header>

    <main>
        <h2>Przydatne Informacje</h2>
        <h3>Kościół</h3>
        <p>Kościół jest dosyć ładny. Powinno spokojnie wystarczyć miejsc dla wszystkich. Jest ogrzewany, więc nie powinno być bardzo zimno. Parking jest przed kościołem oraz drugi, bardzo duży, za nim, po objechaniu go główną ulicą.</p>
        <h3>Sala Weselna</h3>
        <p>Rezydencja Mietowe Wzgórza jest niedaleko lotniska Modlin, pośrodku niczego. </p>
        <h3>Dojazd do sali i powrót</h3>
        <p>Oferujemy wszystkim transport do sali spod kościoła po ślubie. Będzie też jechał autobus z Widzowa, jeśli zbierze się chetna grupa osób. Wszyscy jadący z Widzowa mają zapewniony nocelg na miejscu i powrót do Widzowa rano po śniadaniu. 
        Wszyscy, którzy chcą wrócić do Warszawy będą mieli taką możliwość korzystajac z dwóch autobusów, o północy oraz po zakończeniu wesela, około 2:00 lub 3:00 w nocy</p>
        <h3>Noclegi</h3>
        <p>Rodzinie z daleka proponujemy nocleg na miejscu, lub w pobliskich hotelach, do których zawiezie Was kursujący samochód.</p>
        
        <h2>Plota: Kto już potwierdził? 😉</h2>
        <ul id="plota-list">
            <li>Ładowanie listy gości...</li>
        </ul>

        <h2>Potwierdź swoją obecność</h2>
        <p>Jeżeli będziesz z nami w tym dniu, prosimy o wypełnienie poniższego formularza.</p>
        <form id="guest-form">
            <input type="hidden" name="submissionType" value="confirm">
            <div class="form-group">
                <label for="nazwisko">Nazwisko:</label>
                <input type="text" id="nazwisko" name="Nazwisko" required placeholder="np. Kowalscy">
            </div>
            <div class="form-group">
                <label for="imiona">Imiona gości:</label>
                <input type="text" id="imiona" name="ImionaGosci" required placeholder="np. Anna, Jan (oddzielone przecinkiem)">
            </div>
            <div class="form-group">
                <label for="nocleg">Nocleg:</label>
                <select id="nocleg" name="Nocleg"><option value="Nie dotyczy">Proszę wybrać...</option><option value="Nie, dziękujemy">Nie, dziękujemy</option><option value="Tak, prosimy o rezerwację">Tak, prosimy o rezerwację</option></select>
            </div>
            <div class="form-group">
                <label for="dieta">Informacje o diecie:</label>
                <textarea id="dieta" name="Dieta" rows="3" placeholder="np. wegetariańska, alergie"></textarea>
            </div>
            <div class="form-group">
                <label for="transport-dojazd">Dojazd na wesele:</label>
                <select id="transport-dojazd" name="TransportDojazd"><option value="Brak">Brak / Dojazd własny</option><option value="Autobus z Widzowa">Autobus z Widzowa</option><option value="Autobus spod kościoła">Autobus spod kościoła</option></select>
            </div>
            <div class="form-group">
                <label for="transport-powrot">Powrót z wesela:</label>
                <select id="transport-powrot" name="TransportPowrot"><option value="Brak">Brak / Powrót własny</option><option value="Autobus do Widzowa">Autobus do Widzowa</option><option value="Autobus do centrum Warszawy">Autobus do centrum Warszawy</option></select>
            </div>
            <button type="submit">Tak, będziemy!</button>
        </form>
        <div id="response-confirm" class="form-response"></div>
        
        <h2>Nie możesz być z nami?</h2>
        <p>Z przykrością przyjmujemy tę wiadomość. Daj nam znać, wypełniając poniższe pola, abyśmy mogli zaktualizować listę.</p>
        <form id="decline-form">
             <input type="hidden" name="submissionType" value="decline">
             <div class="form-group">
                <label for="nazwisko-decline">Nazwisko:</label>
                <input type="text" id="nazwisko-decline" name="Nazwisko" required>
            </div>
            <div class="form-group">
                <label for="imiona-decline">Imiona gości:</label>
                <input type="text" id="imiona-decline" name="ImionaGosci" required>
            </div>
            <button type="submit">Niestety, nie damy rady</button>
        </form>
        <div id="response-decline" class="form-response"></div>

    </main>

    <script>
        // UWAGA! Wklej tutaj URL swojej aplikacji webowej z Google Apps Script
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw-y1_Yxl4sqePM-IFXMYqmaKen7Hqe44ZSglsPWvrLG1gkk9BnnPfl4p5wBE-qIibF/exec";

        const plotaList = document.getElementById('plota-list');
        const confirmForm = document.getElementById('guest-form');
        const declineForm = document.getElementById('decline-form');
        const responseConfirmDiv = document.getElementById('response-confirm');
        const responseDeclineDiv = document.getElementById('response-decline');

        // --- 1. Funkcja do ładowania listy "Plota" przy starcie strony ---
        function loadGuestList() {
            fetch(SCRIPT_URL)
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success' && data.data.length > 0) {
                        plotaList.innerHTML = ''; // Wyczyść "Ładowanie..."
                        data.data.forEach(guest => {
                            const li = document.createElement('li');
                            li.textContent = `${guest.surname} (${guest.count} ${guest.count > 1 ? 'osoby' : 'osoba'})`;
                            plotaList.appendChild(li);
                        });
                    } else if (data.result === 'success') {
                        plotaList.innerHTML = '<li>Na razie nikt się nie wpisał. Bądź pierwszy/a!</li>';
                    } else {
                         plotaList.innerHTML = '<li>Nie udało się załadować listy.</li>';
                    }
                })
                .catch(error => {
                    console.error('Błąd ładowania listy gości:', error);
                    plotaList.innerHTML = '<li>Wystąpił błąd podczas ładowania listy.</li>';
                });
        }
        
        // --- 2. Funkcja do obsługi wysyłania formularzy ---
        function handleFormSubmit(form, responseDiv) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const submitButton = form.querySelector('button');
                submitButton.disabled = true;
                submitButton.textContent = 'Przetwarzanie...';

                fetch(SCRIPT_URL, { method: 'POST', body: new FormData(form) })
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === 'success') {
                            responseDiv.textContent = 'Dziękujemy! Twoja odpowiedź została zapisana.';
                            responseDiv.className = 'form-response success';
                            form.reset();
                            loadGuestList(); // Odśwież listę "Plota"
                        } else {
                            throw new Error(data.message || 'Nieznany błąd');
                        }
                    })
                    .catch(error => {
                        console.error('Błąd wysyłania formularza:', error);
                        responseDiv.textContent = 'Wystąpił błąd. Spróbuj ponownie. ' + error.message;
                        responseDiv.className = 'form-response error';
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        // Przywróć oryginalny tekst przycisku
                        if(form.id === 'guest-form') submitButton.textContent = 'Tak, będziemy!';
                        if(form.id === 'decline-form') submitButton.textContent = 'Niestety, nie damy rady';
                        responseDiv.style.display = 'block';
                    });
            });
        }

        // --- 3. Uruchomienie funkcji ---
        document.addEventListener('DOMContentLoaded', loadGuestList);
        handleFormSubmit(confirmForm, responseConfirmDiv);
        handleFormSubmit(declineForm, responseDeclineDiv);
    </script>
</body>
</html>
